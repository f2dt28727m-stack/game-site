<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Ball - Ocean</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:-apple-system;overflow:hidden;background:#001d3d}
        #game{width:100vw;height:100vh;display:block}
        #ui{position:fixed;top:15px;left:0;right:0;text-align:center;pointer-events:none;z-index:10}
        #score{font-size:2rem;font-weight:bold;color:#ffd700;text-shadow:0 0 10px #ffd700}
        #hint{font-size:0.8rem;color:rgba(255,255,255,0.7);margin-top:5px}
        #restart,#win{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(135deg,#11998e,#38ef7d);color:#fff;border:none;padding:15px 40px;font-size:1.2rem;border-radius:30px;cursor:pointer;display:none;z-index:20}
        #win{background:linear-gradient(135deg,#f093fb,#f5576c)}
        .ocean{position:fixed;inset:0;background:linear-gradient(180deg,#001d3d,#003566,#006d77,#83c5be);z-index:0}
        .wave{position:absolute;bottom:0;left:0;width:200%;height:80px;background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120"><path fill="%2383c5be" fill-opacity="0.3" d="M0,60 Q300,120 600,60 T1200,60 v60 H0Z"/></svg>');animation:wave 8s linear infinite}
        @keyframes wave{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
        .bubble{position:absolute;bottom:-20px;background:radial-gradient(circle at 30% 30%,rgba(255,255,255,0.8),rgba(255,255,255,0.1));border-radius:50%;animation:rise linear infinite}
        @keyframes rise{0%{transform:translateY(0);opacity:0.6}100%{transform:translateY(-110vh);opacity:0}}
    </style>
</head>
<body>
    <div class="ocean"><div class="wave"></div></div>
    <div id="bubbles"></div>
    <div id="ui">
        <div id="score">0</div>
        <div id="hint">ðŸŒŠ Draw to guide jellyfish to treasure!</div>
    </div>
    <canvas id="game"></canvas>
    <button id="restart" onclick="restart()">ðŸ”„ Try Again</button>
    <button id="win" onclick="nextLevel()">ðŸ’Ž Next!</button>
    <script>
        // Make bubbles
        for(let i=0;i<15;i++){
            let b=document.createElement('div');
            b.className='bubble';
            b.style.left=Math.random()*100+'%';
            b.style.width=b.style.height=(Math.random()*15+8)+'px';
            b.style.animationDuration=(Math.random()*4+4)+'s';
            b.style.animationDelay=Math.random()*5+'s';
            document.getElementById('bubbles').appendChild(b);
        }
        
        const c=document.getElementById('game'),ctx=c.getContext('2d');
        let W,H,ball,lines=[],cups=[],obs=[],level=1,score=0,running=true,curLine=[],drawing=false;
        
        function r(){W=c.width=window.innerWidth;H=c.height=window.innerHeight}
        r();window.onresize=r;
        
        class Ball{
            constructor(x,y){
                this.x=x;this.y=y;this.vx=0;this.vy=0;this.r=20;this.g=0.35;this.b=0.6;this.f=0.995;this.tent=[];
                for(let i=0;i<5;i++)this.tent.push({o:(i-2)*5,p:Math.random()*6.28});
            }
            update(){
                this.vy+=this.g;this.vx*=this.f;this.vy*=this.f;this.x+=this.vx;this.y+=this.vy;
                if(this.x<this.r){this.x=this.r;this.vx*=-this.b}
                if(this.x>W-this.r){this.x=W-this.r;this.vx*=-this.b}
                if(this.y>H+50&&running){document.getElementById('restart').style.display='block';running=false}
            }
            draw(){
                // Glow
                let g=ctx.createRadialGradient(this.x,this.y,0,this.x,this.y,this.r*2);
                g.addColorStop(0,'rgba(255,105,180,0.6)');
                g.addColorStop(1,'rgba(255,105,180,0)');
                ctx.fillStyle=g;ctx.beginPath();ctx.arc(this.x,this.y,this.r*2,0,6.28);ctx.fill();
                // Body
                ctx.beginPath();ctx.arc(this.x,this.y-3,this.r,Math.PI,0);ctx.quadraticCurveTo(this.x+this.r,this.y+3,this.x,this.y+3);ctx.quadraticCurveTo(this.x-this.r,this.y+3,this.x-this.r,this.y-3);
                ctx.fillStyle='#ff69b4';ctx.fill();ctx.strokeStyle='rgba(255,255,255,0.5)';ctx.lineWidth=2;ctx.stroke();
                // Eyes
                ctx.fillStyle='#fff';ctx.beginPath();ctx.arc(this.x-5,this.y-6,4,0,6.28);ctx.arc(this.x+5,this.y-6,4,0,6.28);ctx.fill();
                ctx.fillStyle='#222';ctx.beginPath();ctx.arc(this.x-4,this.y-5,2,0,6.28);ctx.arc(this.x+6,this.y-5,2,0,6.28);ctx.fill();
                // Tentacles
                ctx.strokeStyle='#ff69b4';ctx.lineWidth=2;
                this.tent.forEach(t=>{ctx.beginPath();ctx.moveTo(this.x+t.o,this.y+3);ctx.quadraticCurveTo(this.x+t.o+Math.sin(Date.now()/200+t.p)*5,this.y+20,this.x+t.o,this.y+30);ctx.stroke()});
            }
        }
        
        class Line{
            constructor(p){this.p=p}
            draw(){if(this.p.length<2)return;ctx.beginPath();ctx.moveTo(this.p[0].x,this.p[0].y);this.p.forEach(pt=>ctx.lineTo(pt.x,pt.y));ctx.strokeStyle='#00ffff';ctx.lineWidth=8;ctx.lineCap='round';ctx.shadowColor='#00ffff';ctx.shadowBlur=15;ctx.stroke();ctx.shadowBlur=0}
            hit(b){for(let i=0;i<this.p.length-1;i++){let p1=this.p[i],p2=this.p[i+1],dx=p2.x-p1.x,dy=p2.y-p1.y,l=Math.sqrt(dx*dx+dy*dy);
                if(l==0)continue;let t=Math.max(0,Math.min(1,((b.x-p1.x)*dx+(b.y-p1.y)*dy)/l)),cx=p1.x+t*dx,cy=p1.y+t*dy,d=Math.sqrt((b.x-cx)**2+(b.y-cy)**2);
                if(d<b.r+4){let nx=(b.x-cx)/d,ny=(b.y-cy)/d;b.vx+=nx*4;b.vy+=ny*4;b.x=cx+nx*(b.r+5);b.y=cy+ny*(b.r+5)}}}
        }
        
        class Cup{
            constructor(x,y){this.x=x;this.y=y;this.w=60;this.h=45;this.filled=false;this.s=0}
            draw(){
                this.s+=0.05;
                let g=ctx.createRadialGradient(this.x,this.y,0,this.x,this.y,this.w);
                g.addColorStop(0,this.filled?'#ffd700':'rgba(255,215,0,0.4)');g.addColorStop(1,'rgba(255,215,0,0)');
                ctx.fillStyle=g;ctx.beginPath();ctx.arc(this.x,this.y,this.w,0,6.28);ctx.fill();
                ctx.fillStyle='#8B4513';ctx.fillRect(this.x-25,this.y-15,50,30);
                ctx.fillStyle='#A0522D';ctx.beginPath();ctx.ellipse(this.x,this.y-15,25,10,0,Math.PI,0);ctx.fill();
                ctx.strokeStyle='#FFD700';ctx.lineWidth=2;ctx.strokeRect(this.x-25,this.y-15,50,30);
                if(!this.filled){for(let i=0;i<4;i++){let a=this.s+i*1.57,sx=this.x+Math.cos(a)*20,sy=this.y+Math.sin(a)*20;ctx.beginPath();ctx.arc(sx,sy,2,0,6.28);ctx.fillStyle='rgba(255,215,0,0.8)';ctx.fill()}}
            }
            hit(b){if(b.x>this.x-25&&b.x<this.x+25&&b.y>this.y-25&&b.y<this.y+15&&!this.filled){this.filled=true;score+=100*level;document.getElementById('score').textContent=score;running=false;document.getElementById('win').style.display='block'}}
        }
        
        class Obs{
            constructor(x,y,w,h){this.x=x;this.y=y;this.w=w;this.h=h;this.c=['#ff6b6b','#ffa07a','#ffb6c1'][Math.floor(Math.random()*3)]}
            draw(){let g=ctx.createLinearGradient(this.x,this.y,this.x,this.y+this.h);g.addColorStop(0,this.c);g.addColorStop(1,'#2d1f1f');ctx.fillStyle=g;ctx.fillRect(this.x,this.y,this.w,this.h);ctx.strokeStyle='rgba(255,255,255,0.3)';ctx.strokeRect(this.x,this.y,this.w,this.h)}
            hit(b){if(b.x+b.r>this.x&&b.x-b.r<this.x+this.w&&b.y+b.r>this.y&&b.y-b.r<this.y+this.h){let l=b.x-this.x,r=this.x+this.w-b.x,t=b.y-this.y,b2=this.y+this.h-b.y,m=Math.min(l,r,t,b2);
                if(m==t){b.y=this.y-b.r;b.vy*=-b.b}else if(m==b2){b.y=this.y+this.h+b.r;b.vy*=-b.b}else if(m==l){b.x=this.x-b.r;b.vx*=-b.b}else{b.x=this.x+this.w+b.r;b.vx*=-b.b}}}
        }
        
        function init(l){
            ball=new Ball(W/2,50);lines=[];cups=[new Cup(W/2,H-80)];obs=[];
            if(l==1){obs.push(new Obs(W/2-80,H/2,160,18));obs.push(new Obs(30,H/2+80,100,18));obs.push(new Obs(W-130,H/2+80,100,18))}
            else if(l==2){obs.push(new Obs(W/2-50,H/3,100,18));obs.push(new Obs(20,H/2,80,18));obs.push(new Obs(W-100,H/2,80,18));obs.push(new Obs(W/2-60,H*2/3,120,18))}
            else{for(let i=0;i<l+1;i++)obs.push(new Obs(Math.random()*(W-120)+60,H/3+Math.random()*H/3,Math.random()*60+40,15))}
            running=true;document.getElementById('restart').style.display='none';document.getElementById('win').style.display='none';document.getElementById('score').textContent=score
        }
        
        function restart(){level=1;score=0;init(level)}
        function nextLevel(){level++;score+=50;init(level)}
        
        c.onmousedown=e=>{if(running){drawing=true;curLine=[{x:e.clientX,y:e.clientY}]}}
        c.onmousemove=e=>{if(drawing&&running)curLine.push({x:e.clientX,y:e.clientY})}
        c.onmouseup=()=>{if(curLine.length>2)lines.push(new Line([...curLine]));drawing=false;curLine=[]}
        c.ontouchstart=e=>{if(running){drawing=true;curLine=[{x:e.touches[0].clientX,y:e.touches[0].clientY}]}}
        c.ontouchmove=e=>{if(drawing&&running){e.preventDefault();curLine.push({x:e.touches[0].clientX,y:e.touches[0].clientY})}}
        c.ontouchend=()=>{if(curLine.length>2)lines.push(new Line([...curLine]));drawing=false;curLine=[]}
        
        function update(){
            ctx.clearRect(0,0,W,H);
            obs.forEach(o=>{o.draw();if(running&&ball)o.hit(ball)});
            lines.forEach(l=>{l.draw();if(running&&ball)l.hit(ball)});
            if(curLine.length>1){ctx.beginPath();ctx.moveTo(curLine[0].x,curLine[0].y);curLine.forEach(p=>ctx.lineTo(p.x,p.y));ctx.strokeStyle='#00ffff';ctx.lineWidth=8;ctx.lineCap='round';ctx.stroke()}
            cups.forEach(cup=>{cup.draw();if(running&&ball)cup.hit(ball)});
            if(ball){ball.update();ball.draw()}
            requestAnimationFrame(update)
        }
        
        init(1);update();
    </script>
</body>
</html>
