<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ÂêàÊàêÂ§ßË•øÁìú</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:sans-serif}
body{display:flex;justify-content:center;align-items:center;flex-direction:column;gap:8px;background:#1a1a2e;padding:10px;min-height:100vh}
.score{font-size:24px;font-weight:700;color:#ffd700;text-shadow:0 0 10px rgba(255,215,0,0.5)}
#game{width:320px;height:520px;background:#0f0f23;border:3px solid #667eea;position:relative;overflow:hidden;border-radius:12px;box-shadow:0 0 40px rgba(102,126,234,0.4)}
#warnLine{position:absolute;top:100px;left:0;width:100%;height:3px;background:linear-gradient(90deg,transparent,#e94560,transparent);opacity:0.8}
.ball{position:absolute;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:bold;font-size:10px;text-shadow:0 1px 2px rgba(0,0,0,0.5)}
</style>
</head>
<body>
<div class="score" id="score">0</div>
<div id="game">
  <div id="warnLine"></div>
</div>

<script>
const game = document.getElementById('game');
const scoreEl = document.getElementById('score');
let score = 0;
let gameOver = false;
const G = 0.25;
const FRIC = 0.98;
const BOUNCE = 0.55;

const ballTypes = [
  {r:12, c:'#8B4513', n:'üçí', s:''},
  {r:15, c:'#FF6347', n:'üçì', s:''},
  {r:18, c:'#FFA500', n:'üçä', s:''},
  {r:22, c:'#FFD700', n:'üçã', s:''},
  {r:26, c:'#32CD32', n:'ü•ù', s:''},
  {r:30, c:'#FF69B4', n:'üçë', s:''},
  {r:35, c:'#9370DB', n:'üçá', s:''},
  {r:42, c:'#FF4500', n:'üçé', s:''},
  {r:52, c:'#FFD700', n:'üçà', s:''},
  {r:65, c:'#006400', n:'üçâ', s:''},
  {r:80, c:'#FF1493', n:'‚≠ê', s:''}
];

let balls = [];
let holdBall = null;

function randBallType(){ return ballTypes[Math.floor(Math.random()*3)] }

function createBall(type, x, y){
  const el = document.createElement('div');
  el.className = 'ball';
  el.style.width = el.style.height = type.r*2 + 'px';
  el.style.background = type.c;
  el.style.fontSize = (type.r*0.9) + 'px';
  el.innerText = type.n;
  game.appendChild(el);
  const b = {el, type, x, y, vx:0, vy:0, r:type.r};
  el._data = b;
  return b;
}

function update(){
  if(gameOver) return requestAnimationFrame(update);
  if(!holdBall) holdBall = createBall(randBallType(), 160, -40);

  balls.forEach(b=>{
    if(b === holdBall) return;
    b.vy += G;
    b.x += b.vx;
    b.y += b.vy;
    b.vx *= FRIC;
    if(b.x - b.r < 0){ b.x = b.r; b.vx *= -BOUNCE }
    if(b.x + b.r > 320){ b.x = 320 - b.r; b.vx *= -BOUNCE }
    if(b.y + b.r > 520){ b.y = 520 - b.r; b.vy *= -BOUNCE }
    b.el.style.left = (b.x - b.r) + 'px';
    b.el.style.top = (b.y - b.r) + 'px';
  });

  checkCollide();
  checkLose();
  requestAnimationFrame(update);
}

function checkCollide(){
  for(let i=0;i<balls.length;i++){
    for(let j=i+1;j<balls.length;j++){
      const a = balls[i], b = balls[j];
      if(!a || !b || a.type!==b.type) continue;
      const dx = a.x - b.x, dy = a.y - b.y;
      const d = Math.hypot(dx, dy);
      if(d < a.r + b.r - 3){
        merge(a,b);
        i--; break;
      }
    }
  }
}

function merge(a,b){
  const idx = ballTypes.indexOf(a.type);
  if(idx <0 || idx >= ballTypes.length-1) return;
  game.removeChild(a.el);
  game.removeChild(b.el);
  balls = balls.filter(p=>p!==a && p!==b);
  const nx = (a.x+b.x)/2, ny = (a.y+b.y)/2;
  const nxt = createBall(ballTypes[idx+1], nx, ny);
  nxt.vx = (a.vx+b.vx)*0.3;
  nxt.vy = (a.vy+b.vy)*0.3 - 2;
  balls.push(nxt);
  addScore((idx+1)*10);
}

function addScore(s){ score += s; scoreEl.innerText = score }

function checkLose(){
  if(gameOver) return;
  // Only check balls that have dropped and are stationary
  for(const b of balls){
    if(b.y - b.r < 100 && Math.abs(b.vy) < 2){
      gameOver = true;
      setTimeout(()=>{ alert('Ê∏∏ÊàèÁªìÊùüÔºÅÂæóÂàÜÔºö'+score); location.reload(); },100);
    }
  }
}

function moveBall(clientX){
  if(!holdBall || gameOver) return;
  const r = game.getBoundingClientRect();
  let x = clientX - r.left;
  x = Math.max(holdBall.r, Math.min(320-holdBall.r, x));
  holdBall.x = x;
  holdBall.el.style.left = (x - holdBall.r) + 'px';
}

document.addEventListener('mousemove', e=>moveBall(e.clientX));
document.addEventListener('touchmove', e=>{ e.preventDefault(); moveBall(e.touches[0].clientX) }, {passive: false});

function dropBall(){
  if(holdBall && !gameOver){
    balls.push(holdBall);
    holdBall = null;
  }
}
document.addEventListener('click', dropBall);
document.addEventListener('touchend', dropBall);

update();
</script>
</body>
</html>
